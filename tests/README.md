# üß™ –¢–µ—Å—Ç—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ AskMe

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py              # –ü–∞–∫–µ—Ç —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ conftest.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ test_views.py            # –¢–µ—Å—Ç—ã API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
‚îî‚îÄ‚îÄ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
```

## –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –í–æ–ø—Ä–æ—Å—ã (Questions)
- ‚úÖ `GET /api/questions/` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ `POST /api/questions/` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
- ‚úÖ `GET /api/questions/{id}/` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ —Å –æ—Ç–≤–µ—Ç–∞–º–∏
- ‚úÖ `DELETE /api/questions/{id}/` - —É–¥–∞–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞

### –û—Ç–≤–µ—Ç—ã (Answers)
- ‚úÖ `POST /api/questions/{id}/answers/` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∫ –≤–æ–ø—Ä–æ—Å—É
- ‚úÖ `GET /api/answers/{id}/` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ `DELETE /api/answers/{id}/` - —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

**Windows:**
```cmd
run_tests.bat
```

**Linux/Mac:**
```bash
chmod +x run_tests.sh
./run_tests.sh
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
source venv/Scripts/activate  # Windows: venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements-test.txt

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
python -m pytest tests/ -v

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
python -m pytest tests/ --cov=askme --cov-report=html

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Ç–µ—Å—Ç–æ–≤
python -m pytest tests/test_views.py::TestQuestionsAPI -v

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
python -m pytest tests/test_views.py::TestQuestionsAPI::test_get_questions_list_empty -v

# –ó–∞–ø—É—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
python -m pytest tests/ -k "test_question" -v
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
python -m pytest tests/ --cov=askme --cov-report=html

# –û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# Windows: start htmlcov/index.html
# Linux: xdg-open htmlcov/index.html
# Mac: open htmlcov/index.html
```

### –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤
```bash
# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
python -m pytest tests/ -v

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
python -m pytest tests/ -x

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
python -m pytest tests/ --lf

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
python -m pytest tests/ -s
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
```bash
# –ü–æ –º–∞—Ä–∫–µ—Ä–∞–º
python -m pytest tests/ -m "not slow"

# –ü–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É –∏–º–µ–Ω–∏
python -m pytest tests/ -k "test_question"

# –ü–æ –∫–ª–∞—Å—Å—É
python -m pytest tests/test_models.py::TestQuestionModel
```

## –§–∏–∫—Å—Ç—É—Ä—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã (`conftest.py`)

- `api_client` - APIClient –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
- `sample_question` - —Ç–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å
- `sample_questions` - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- `sample_answer` - —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
- `sample_answers` - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- `question_data` - –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞
- `answer_data` - –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- `invalid_question_data` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å–∞
- `invalid_answer_data` - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

```python
def test_example(api_client, sample_question):
    """–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∏–∫—Å—Ç—É—Ä."""
    url = reverse('question-detail', kwargs={'pk': sample_question.id})
    response = api_client.get(url)
    assert response.status_code == 200
```

## –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

```python
@pytest.mark.slow
def test_slow_operation():
    """–¢–µ—Å—Ç –º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏."""
    pass

@pytest.mark.integration
def test_api_integration():
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç API."""
    pass
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pytest

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `pytest.ini`:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
- –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤
- –û–ø—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞

```python
# tests/test_new_feature.py
import pytest
from django.urls import reverse

class TestNewFeature:
    def test_new_functionality(self, api_client):
        """–¢–µ—Å—Ç –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏."""
        # –í–∞—à —Ç–µ—Å—Ç –∑–¥–µ—Å—å
        pass
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª

```python
def test_new_test_case(self, api_client, sample_question):
    """–ù–æ–≤—ã–π —Ç–µ—Å—Ç-–∫–µ–π—Å."""
    # –í–∞—à —Ç–µ—Å—Ç –∑–¥–µ—Å—å
    pass
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ–∏–∫—Å—Ç—É—Ä—ã

```python
# –í conftest.py
@pytest.fixture
def new_fixture():
    """–ù–æ–≤–∞—è —Ñ–∏–∫—Å—Ç—É—Ä–∞."""
    return "test_data"
```

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
2. **–û–¥–∏–Ω —Ç–µ—Å—Ç - –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞** - –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–¥–Ω—É –≤–µ—â—å
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã** - –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏** - –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
5. **–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞** - —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –≤—ã—Å–æ–∫–æ–º—É –ø–æ–∫—Ä—ã—Ç–∏—é
6. **–ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã** - –∏–∑–±–µ–≥–∞–π—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ unit —Ç–µ—Å—Ç–∞—Ö

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```bash
# –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python manage.py flush --noinput

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
python manage.py migrate
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements-test.txt --force-reinstall
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ PYTHONPATH
python -c "import sys; print(sys.path)"

# –ó–∞–ø—É—Å–∫ –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/project
python -m pytest tests/
```
